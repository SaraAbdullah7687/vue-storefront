{"version":3,"file":"index.cjs.js","sources":["../src/index.ts","../src/composables/useCache.ts"],"sourcesContent":["/**\n * Core Vue Storefront 2 library for enabling Server Side Rendering (SSR) cache.\n *\n * @remarks\n * The `@vue-storefront/cache` library is a Nuxt.js module, that is core piece required\n * to enable Server Side Rendering (SSR) cache in Vue Storefront 2. It uses drivers\n * to integration with specific caching solutions.\n *\n * @packageDocumentation\n */\n\nexport { useCache } from './composables/useCache';\n\nexport enum CacheTagPrefix {\n  Product = 'P',\n  Category = 'C',\n  Attribute = 'A',\n  Cart = 'B',\n  Filter = 'F',\n  Block = 'O',\n  View = 'V'\n}\n\nexport interface CacheTag {\n  prefix: CacheTagPrefix | string;\n  value: string;\n}\n\nexport type CacheDriver = (options: any) => {\n  invoke: () => Promise<any>;\n  invalidate: () => Promise<any>;\n}\n\nexport type SetTagsFn = (tags: CacheTag[]) => CacheTag[];\n\nexport interface UseCache {\n  addTags(tags: CacheTag[]): void;\n  clearTags(): void;\n  getTags(): CacheTag[];\n  setTags(callback: SetTagsFn): void;\n}\n","import { CacheTag, UseCache, SetTagsFn } from '../index';\nimport { useContext } from '@nuxtjs/composition-api';\n\nexport const useCache = (): UseCache => {\n  const { req }: any = useContext();\n  const isCacheEnabled = req && req.$vsfCache ? req.$vsfCache.enabled : false;\n\n  if (!req || !isCacheEnabled) {\n    return {\n      addTags: () => {},\n      clearTags: () => {},\n      getTags: () => [],\n      setTags: () => {}\n    };\n  }\n\n  const $vsfCache = req.$vsfCache;\n  const addTags = (tags: CacheTag[]) => tags.forEach(tag => $vsfCache.tagsSet.add(tag));\n  const clearTags = () => $vsfCache.tagsSet.clear();\n  const getTags = (): CacheTag[] => Array.from($vsfCache.tagsSet);\n  const setTags = (fn: SetTagsFn) => {\n    const tagsSet = $vsfCache.tagsSet;\n    const newTags = fn(Array.from(tagsSet));\n    tagsSet.clear();\n    newTags.forEach(tag => tagsSet.add(tag));\n  };\n\n  return {\n    addTags,\n    clearTags,\n    getTags,\n    setTags\n  };\n};\n"],"names":["CacheTagPrefix","req","useContext","isCacheEnabled","$vsfCache","enabled","addTags","clearTags","getTags","setTags","tags","forEach","tag","tagsSet","add","clear","Array","from","fn","newTags"],"mappings":"6GAaA,IAAYA,EAAAA,QAQXA,oBAAA,GARWA,EAAAA,QAAcA,iBAAdA,uBAQX,KAPC,QAAA,IACAA,EAAA,SAAA,IACAA,EAAA,UAAA,IACAA,EAAA,KAAA,IACAA,EAAA,OAAA,IACAA,EAAA,MAAA,IACAA,EAAA,KAAA,qBCjBsB,KACtB,MAAMC,IAAEA,GAAaC,EAAAA,aACfC,KAAiBF,IAAOA,EAAIG,YAAYH,EAAIG,UAAUC,QAE5D,IAAKJ,IAAQE,EACX,MAAO,CACLG,QAAS,OACTC,UAAW,OACXC,QAAS,IAAM,GACfC,QAAS,QAIb,MAAML,EAAYH,EAAIG,UAWtB,MAAO,CACLE,QAXeI,GAAqBA,EAAKC,SAAQC,GAAOR,EAAUS,QAAQC,IAAIF,KAY9EL,UAXgB,IAAMH,EAAUS,QAAQE,QAYxCP,QAXc,IAAkBQ,MAAMC,KAAKb,EAAUS,SAYrDJ,QAXeS,IACf,MAAML,EAAUT,EAAUS,QACpBM,EAAUD,EAAGF,MAAMC,KAAKJ,IAC9BA,EAAQE,QACRI,EAAQR,SAAQC,GAAOC,EAAQC,IAAIF"}