import e from"fs";import n from"path";import t from"consola";import s from"chalk";import{mergeWith as o,isArray as r,merge as i}from"lodash";var u=Object.freeze({info:function(e){return t.info(s.bold("VSF"),e)},success:function(e){return t.success(s.bold("VSF"),e)},warning:function(e){return t.warn(s.bold("VSF"),e)},error:function(e){return t.error(s.bold("VSF"),e)}}),c=function(e,n){return o(e,n,(function(e,n){if(r(e))return e.concat(n)}))};function l(e){try{return require.resolve(e,{paths:[process.cwd()]})}catch(e){return""}}function a(){this.options.render=i(this.options.render,{http2:{push:!0,pushAssets:function(e,n,t,s){return s.filter((function(e){return"script"===e.asType})).map((function(e){var n=e.file,s=e.asType;return"<".concat(t).concat(n,">; rel=preload; as=").concat(s)}))}}})}function p(e){this.nuxt.hook("modules:done",(function(n){return n.addModule(["nuxt-purgecss",e])}))}function d(e){var n=e.performance,t=n.httpPush,s=n.purgeCSS;t&&a.call(this),s&&s.enabled&&p.call(this,s)}function f(e){var n=["@storefront-ui/vue","@storefront-ui/shared"];e.useRawSource=c(e.useRawSource,{dev:n,prod:n})}function h(e){f.call(this,e)}function g(e){var n=this;e.useRawSource[function(e){return"production"===process.env.NODE_ENV||e.coreDevelopment}(e)?"prod":"dev"].map((function(e){return function(e){var t=l("".concat(e,"/package.json")),s=require(t||"");s.module&&n.extendBuild((function(n){n.resolve.alias[s.name+"$"]=l("".concat(e,"/").concat(s.module))})),n.options.build.transpile.push(e),u.info("Using raw source/ESM for ".concat(s.name))}(e)}))}var m={name:"@vue-storefront/nuxt",version:"2.7.5",main:"lib/index.cjs.js",module:"lib/index.es.js",types:"lib/src/index.d.ts",scripts:{build:"rimraf lib && rollup -c",test:'echo "Error: no test specified" && exit 1',prepublish:"yarn build"},author:"Vue Storefront",license:"MIT",dependencies:{"@nuxt/typescript-build":"^2.0.0","@nuxtjs/composition-api":"^0.29.3","@nuxtjs/style-resources":"^1.0.0",chalk:"^2.4.2",chokidar:"^3.3.1",consola:"^2.10.1",lodash:"^4.17.15","nuxt-purgecss":"^1.0.0"},devDependencies:{"@nuxt/types":"^2.15.8","@rollup/plugin-json":"~4.1.0"},publishConfig:{access:"public"},files:["lib/**/*","plugins/**/*"],engines:{node:">=14 <=16"}};function v(t){var s=c({coreDevelopment:!1,i18nExtension:!0,e2e:!0,logger:!0,ssr:!0,context:!0,sfui:!0,performance:{httpPush:!0,purgeCSS:{enabled:!1,paths:["**/*.vue"]}},useRawSource:{dev:[],prod:[]}},t);this.options.head.meta.push({name:"generator",content:"Vue Storefront 2"}),u.info("Starting Vue Storefront Nuxt Module"),s.performance.httpPush&&(this.options.render=c(this.options.render,{http2:{push:!0,pushAssets:function(e,n,t,s){return s.filter((function(e){return"script"===e.asType})).map((function(e){var n=e.file,s=e.asType;return"<".concat(t).concat(n,">; rel=preload; as=").concat(s)}))}}})),s.context&&(this.addPlugin(n.resolve(__dirname,"../plugins/context.js")),u.success("Installed Vue Storefront Context plugin")),s.ssr&&(this.addPlugin(n.resolve(__dirname,"../plugins/ssr.js")),u.success("Installed Vue Storefront SSR plugin")),s.logger&&(this.addPlugin({src:n.resolve(__dirname,"../plugins/logger.js"),options:t.logger||{}}),u.success("Installed VSF Logger plugin")),s.e2e&&(this.addPlugin(n.resolve(__dirname,"../plugins/e2e-testing.js")),u.success("Installed Vue Storefront E2E testing plugin")),s.i18nExtension&&(this.addPlugin({src:n.resolve(__dirname,"../plugins/i18n-cookies.js"),options:this.options.i18n}),u.success("Installed Internationalization Cookies plugin")),e.existsSync(l("@storefront-ui/vue"))&&s.sfui&&(h.call(this,s),u.success("Installed StorefrontUI Module")),d.call(this,s),u.success("Installed Performance Module"),g.call(this,s)}export{v as default,m as meta};
//# sourceMappingURL=index.es.js.map
